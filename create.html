<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stwórz serwer — kreator</title>
<style>body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;padding:20px;max-width:720px;margin:0 auto}label,input,button{display:block;margin:8px 0}pre{background:#f6f8fa;padding:12px;border-radius:6px;overflow:auto}button{background:#f59e0b;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}a.btn{display:inline-block;padding:8px 12px;border-radius:8px;background:#f59e0b;color:#08121a;text-decoration:none}</style>
</head>
<body>
<h1>Stwórz serwer</h1>
<p>Ten interfejs łączy się z GitHub (OAuth) i może utworzyć repo/ Codespace. Jeśli nie masz backendu, użyj przycisku „Otwórz w Codespaces”.</p>

<div id="not-auth">
  <p>Nie jesteś zalogowany.</p>
  <a class="btn" href="https://github.com/login" target="_blank" rel="noopener">Zaloguj przez GitHub</a>
</div>

<div id="form" style="display:none">
<label>Nazwa repo (np. mój-serwer)</label>
<input id="repoName" placeholder="nazwa-repo" />
<label>Publiczne?</label>
<select id="visibility"><option value="public">publiczne</option><option value="private">prywatne</option></select>
<button id="create">Stwórz</button>
<h3>Wynik:</h3>
<pre id="out">—</pre>
</div>

<p style="margin-top:10px"><a class="btn" href="https://codespaces.new/FranQ213/PotatoHost" target="_blank" rel="noopener">Otwórz w Codespaces</a></p>

<script>
async function checkAuth(){
  try{
    const r = await fetch('/api/me');
    if(r.ok){
      document.getElementById('not-auth').style.display = 'none';
      document.getElementById('form').style.display = 'block';
    } else {
      document.getElementById('not-auth').style.display = '';
      document.getElementById('form').style.display = 'none';
    }
  }catch(e){
    document.getElementById('not-auth').style.display = '';
    document.getElementById('form').style.display = 'none';
  }
}
checkAuth();

document.getElementById('create')?.addEventListener('click', async ()=>{
  const name = document.getElementById('repoName').value || ('server-'+Math.random().toString(36).slice(2,8));
  const visibility = document.getElementById('visibility').value;
  try{
    const res = await fetch('/api/create-server', {method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({name, visibility})});
    const j = await res.json();
    document.getElementById('out').textContent = JSON.stringify(j, null, 2);
  }catch(e){
    document.getElementById('out').textContent = 'Błąd: ' + e.message + '\\n(ten przycisk działa tylko gdy masz backend obsługujący /api/create-server)';
  }
});
</script>
</body>
</html>
